# Copyright the Service Broker Project Authors. All rights reserved.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

# This file is AUTOGENERATED by ./cloud-service-broker generate, DO NOT EDIT IT.

---
name: cloud-service-broker
icon_file: gcp_logo.png
label: Google Cloud Platform Service Broker
description: 'A service broker for Google Cloud Platform services.'
product_version: "5.0.0"
org: system

stemcell_criteria:
  os: 'ubuntu-xenial'
  version: '170.82'

apply_open_security_group: true

migration: |
  {
  // migration: 0, Delete whitelist keys from 4.x
  delete properties.properties['.properties.gsb_service_google_bigquery_whitelist'];
  delete properties.properties['.properties.gsb_service_google_bigtable_whitelist'];
  delete properties.properties['.properties.gsb_service_google_cloudsql_mysql_whitelist'];
  delete properties.properties['.properties.gsb_service_google_cloudsql_postgres_whitelist'];
  delete properties.properties['.properties.gsb_service_google_ml_apis_whitelist'];
  delete properties.properties['.properties.gsb_service_google_pubsub_whitelist'];
  delete properties.properties['.properties.gsb_service_google_spanner_whitelist'];
  delete properties.properties['.properties.gsb_service_google_storage_whitelist'];
  
  }
  

packages:
- name: cloud-service-broker
  type: app-broker
  manifest:
    buildpacks: 
    - go_buildpack
    path: /tmp/cloud-service-broker.zip
    env:
      GOPACKAGENAME: github.com/cloudfoundry/cloud-service-broker
      GOVERSION: go1.16
      # You can override plans here.
  needs_cf_credentials: true
  enable_global_access_to_plans: true


# Uncomment this section if you want to display forms with configurable
# properties in Ops Manager. These properties will be passed to your
# applications as environment variables. You can also refer to them
# elsewhere in this template by using:
#     (( .properties.<property-name> ))
forms:
- name: root_service_account
  label: Root Service Account
  description: Please paste in the contents of the json keyfile (un-encoded) for your
    service account with owner credentials.
  properties:
  - name: root_service_account_json
    type: text
    label: Root Service Account JSON
    configurable: true
- name: database_properties
  label: Database Properties
  description: Connection details for the backing database for the service broker.
  properties:
  - name: db_host
    type: string
    label: Database host
    configurable: true
  - name: db_username
    type: string
    label: Database username
    configurable: true
    optional: true
  - name: db_password
    type: secret
    label: Database password
    configurable: true
    optional: true
  - name: db_port
    type: string
    default: "3306"
    label: Database port (defaults to 3306)
    configurable: true
  - name: db_name
    type: string
    default: servicebroker
    label: Database name
    configurable: true
  - name: ca_cert
    type: text
    label: Server CA cert
    configurable: true
    optional: true
  - name: client_cert
    type: text
    label: Client cert
    configurable: true
    optional: true
  - name: client_key
    type: text
    label: Client key
    configurable: true
    optional: true
- name: brokerpaks
  label: Brokerpaks
  description: |-
    Brokerpaks are ways to extend the broker with custom services defined by Terraform templates.
    A brokerpak is an archive comprised of a versioned Terraform binary and providers for one or more platform, a manifest, one or more service definitions, and source code.
  properties:
  - name: gsb_brokerpak_config
    type: text
    default: '{}'
    label: Global Brokerpak Configuration
    description: A JSON map of configuration key/value pairs for all brokerpaks. If
      a variable isn't found in the specific brokerpak's configuration it's looked
      up here.
    configurable: true
- name: features
  label: Feature Flags
  description: Service broker feature flags.
  properties:
  - name: gsb_compatibility_enable_builtin_brokerpaks
    type: boolean
    default: "true"
    label: enable-builtin-brokerpaks
    description: Load brokerpaks that are built-in to the software.
    configurable: true
  - name: gsb_compatibility_enable_builtin_services
    type: boolean
    default: "true"
    label: enable-builtin-services
    description: Enable services that are built in to the broker i.e. not brokerpaks.
    configurable: true
  - name: gsb_compatibility_enable_catalog_schemas
    type: boolean
    default: "false"
    label: enable-catalog-schemas
    description: Enable generating JSONSchema for the service catalog.
    configurable: true
  - name: gsb_compatibility_enable_cf_sharing
    type: boolean
    default: "false"
    label: enable-cf-sharing
    description: Set all services to have the Sharable flag so they can be shared
      across spaces in PCF.
    configurable: true
  - name: gsb_compatibility_enable_eol_services
    type: boolean
    default: "false"
    label: enable-eol-services
    description: Enable broker services that are end of life.
    configurable: true
  - name: gsb_compatibility_enable_gcp_beta_services
    type: boolean
    default: "true"
    label: enable-gcp-beta-services
    description: Enable services that are in GCP Beta. These have no SLA or support
      policy.
    configurable: true
  - name: gsb_compatibility_enable_gcp_deprecated_services
    type: boolean
    default: "false"
    label: enable-gcp-deprecated-services
    description: Enable services that use deprecated GCP components.
    configurable: true
  - name: gsb_compatibility_enable_preview_services
    type: boolean
    default: "true"
    label: enable-preview-services
    description: Enable services that are new to the broker this release.
    configurable: true
  - name: gsb_compatibility_enable_terraform_services
    type: boolean
    default: "false"
    label: enable-terraform-services
    description: Enable services that use the experimental, unstable, Terraform back-end.
    configurable: true
  - name: gsb_compatibility_enable_unmaintained_services
    type: boolean
    default: "false"
    label: enable-unmaintained-services
    description: Enable broker services that are unmaintained.
    configurable: true
service_plan_forms:
- name: gsb_brokerpak_sources
  label: Configure Brokerpaks
  description: Configure Brokerpaks
  optional: true
  properties:
  - name: uri
    type: string
    label: Brokerpak URI
    description: "The URI to load. Supported protocols are http, https, gs, and git.\n\t\t\t\tCloud
      Storage (gs) URIs follow the gs://<bucket>/<path> convention and will be read
      using the service broker service account.\n\n\t\t\t\tYou can validate the checksum
      of any file on download by appending a checksum query parameter to the URI in
      the format type:value.\n\t\t\t\tValid checksum types are md5, sha1, sha256 and
      sha512. e.g. gs://foo/bar.brokerpak?checksum=md5:3063a2c62e82ef8614eee6745a7b6b59"
    configurable: true
  - name: service_prefix
    type: string
    label: Service Prefix
    description: A prefix to prepend to every service name. This will be exact, so
      you may want to include a trailing dash.
    configurable: true
    optional: true
  - name: excluded_services
    type: text
    label: Excluded Services
    description: A list of UUIDs of services to exclude, one per line.
    configurable: true
    optional: true
  - name: config
    type: text
    default: '{}'
    label: Brokerpak Configuration
    description: A JSON map of configuration key/value pairs for the brokerpak. If
      a variable isn't found here, it's looked up in the global config.
    configurable: true
  - name: notes
    type: text
    label: Notes
    description: A place for your notes, not used by the broker.
    configurable: true
    optional: true
